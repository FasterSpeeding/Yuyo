<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 9.0.1" />
    <title>yuyo.backoff API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>pre{line-height:125%;}td.linenos pre{color:#ff5555;background-color:#282a36;padding-left:5px;padding-right:5px;}span.linenos{color:#ff5555;background-color:#282a36;padding-left:5px;padding-right:5px;}td.linenos pre.special{color:#ff5555;background-color:#ffffc0;padding-left:5px;padding-right:5px;}span.linenos.special{color:#ff5555;background-color:#ffffc0;padding-left:5px;padding-right:5px;}.pdoc .hll{background-color:#282a36;}.pdoc{background:#282a36;color:#ff5555;}.pdoc .c{color:#6a7aaa;}.pdoc .err{color:#ff5555;background-color:#1e0010;}.pdoc .k{color:#ff79c6;}.pdoc .l{color:#ae81ff;}.pdoc .n{color:#f8f8f2;}.pdoc .o{color:#ff79c6;}.pdoc .p{color:#f8f8f2;}.pdoc .ch{color:#6a7aaa;}.pdoc .cm{color:#6a7aaa;}.pdoc .cp{color:#6a7aaa;}.pdoc .cpf{color:#6a7aaa;}.pdoc .c1{color:#6a7aaa;}.pdoc .cs{color:#6a7aaa;}.pdoc .gd{color:#6a7aaa;}.pdoc .ge{font-style:italic;}.pdoc .gi{color:#a6e22e;}.pdoc .go{color:#ff79c6;}.pdoc .gp{color:#f92672;font-weight:bold;}.pdoc .gs{font-weight:bold;}.pdoc .gu{color:#75715e;}.pdoc .kc{color:#ff79c6;}.pdoc .kd{color:#bd93f9;}.pdoc .kn{color:#ff79c6;}.pdoc .kp{color:#bd93f9;}.pdoc .kr{color:#ff79c6;}.pdoc .kt{color:#ff79c6;}.pdoc .ld{color:#e6db74;}.pdoc .m{color:#ae81ff;}.pdoc .s{color:#e6db74;}.pdoc .na{color:#a6e22e;}.pdoc .nb{color:#8be9fd;}.pdoc .nc{color:#8be9fd;}.pdoc .no{color:#ff79c6;}.pdoc .nd{color:#8be9fd;}.pdoc .ni{color:#ff79c6;}.pdoc .ne{color:#8be9fd;}.pdoc .nf{color:#50fa7b;}.pdoc .nl{color:#f8f8f2;}.pdoc .nn{color:#f8f8f2;}.pdoc .nx{color:#a6e22e;}.pdoc .py{color:#f8f8f2;}.pdoc .nt{color:#f92672;}.pdoc .nv{color:#f8f8f2;}.pdoc .ow{color:#ff79c6;}.pdoc .w{color:#f8f8f2;}.pdoc .mb{color:#ae81ff;}.pdoc .mf{color:#ae81ff;}.pdoc .mh{color:#ae81ff;}.pdoc .mi{color:#ae81ff;}.pdoc .mo{color:#ae81ff;}.pdoc .sa{color:#ff79c6;}.pdoc .sb{color:#e6db74;}.pdoc .sc{color:#e6db74;}.pdoc .dl{color:#e6db74;}.pdoc .sd{color:#6272a4;}.pdoc .s2{color:#e6db74;}.pdoc .se{color:#ae81ff;}.pdoc .sh{color:#e6db74;}.pdoc .si{color:#bd93f9;}.pdoc .sx{color:#e6db74;}.pdoc .sr{color:#e6db74;}.pdoc .s1{color:#e6db74;}.pdoc .ss{color:#e6db74;}.pdoc .bp{color:#bd93f9;}.pdoc .fm{color:#bd93f9;}.pdoc .vc{color:#bd93f9;}.pdoc .vg{color:#f8f8f2;}.pdoc .vi{color:#ffffff;}.pdoc .vm{color:#bd93f9;}.pdoc .il{color:#ae81ff;}.pdoc .nd{color:#50fa7b;}*{font-family:SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}.pdoc .classattr{color:#fff;}.pdoc p{color:#fff;font-weight:300;}.pdoc .modulename{color:#fff;font-weight:0;margin:0.3em 0;padding:0.2em 0;}.pdoc h5{color:white;font-style:italic;}nav.pdoc a.function{color:#4dec75;}nav.pdoc a.variable{color:white;}nav.pdoc a.class{color:#8be9fd;}nav.pdoc a.class:hover{color:#fff;}nav.pdoc li a{color:#bd93f9;}.pdoc span.default_value{color:#e6db74;}.pdoc .attr{color:white;}.pdoc h6#attributes{color:#fff;font-size:23px;}.pdoc h6#example{color:#fff;font-size:29px;}.pdoc h6#examples{color:#fff;font-size:29px;}.pdoc h6#notes{font-size:23px;color:orange;}.pdoc h6#warnings{font-size:23px;color:orange;}.pdoc h6#returns{font-size:23px;color:white;}.pdoc h6#parameters{font-size:23px;color:white;}.pdoc h6#other-parameters{font-size:23px;color:white;}.pdoc h6#raises{font-size:23px;color:#ff6666;}.pdoc .kc{color:#bd93f9;}.pdoc li{color:white;}.pdoc div.decorator{color:#50fa7b;}.pdoc strong,b{color:rgb(244, 90, 177);font-weight:normal;}.pdoc em{color:orange;}.pdoc span.name{color:#8be9fd;}.pdoc span.base{color:#8be9fd;}.pdoc span.def{font-weight:normal;}.pdoc .inherited dt,.pdoc .inherited dt::before{color:#8be9fd;}.pdoc .inherited dd,.pdoc .inherited dd{color:#fff;}.pdoc .inherited dd:not(:last-child)::after{color:#fff;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;margin-bottom:1rem;color:white;border-color:white;}nav.pdoc .module-list-button:hover{border-color:white;color:white;}.pdoc h1,.pdoc h2,.pdoc h3{font-weight:300;margin:0.3em 0;padding:0.2em 0;color:white;}</style>
<style>/*! pdoc */:root{--pdoc-background:#272935;}.pdoc{--text:white;--muted:#9d9d9d;--link:#bd93f9;--link-hover:white;--active:#555;--code:#232627;--accent:#232627;--accent2:#FFF;--nav-hover:rgba(0, 0, 0, 0.1);--name:#50fa7b;--def:rgb(244, 90, 177);--annotation:white;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
            <div>
                        <a class="pdoc-button module-list-button" href="../yuyo.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;yuyo</a>


                        <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                               pattern=".+" required>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#Backoff">Backoff</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Backoff.__init__">Backoff</a>
                        </li>
                        <li>
                                <a class="variable" href="#Backoff.is_depleted">is_depleted</a>
                        </li>
                        <li>
                                <a class="function" href="#Backoff.backoff">backoff</a>
                        </li>
                        <li>
                                <a class="function" href="#Backoff.finish">finish</a>
                        </li>
                        <li>
                                <a class="function" href="#Backoff.reset">reset</a>
                        </li>
                        <li>
                                <a class="function" href="#Backoff.set_next_backoff">set_next_backoff</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ErrorManager">ErrorManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ErrorManager.__init__">ErrorManager</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorManager.clear_rules">clear_rules</a>
                        </li>
                        <li>
                                <a class="function" href="#ErrorManager.with_rule">with_rule</a>
                        </li>
                </ul>

            </li>
    </ul>



                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../yuyo.html">yuyo</a><wbr>.backoff    </h1>

                        <div class="docstring"><p>Utility used for handling automatic back-off.</p>

<p>This can be used to cover cases such as hitting rate-limits and failed requests.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># cython: language_level=3</span>
<span class="c1"># BSD 3-Clause License</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2020-2022, Faster Speeding</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are met:</span>
<span class="c1">#</span>
<span class="c1"># * Redistributions of source code must retain the above copyright notice, this</span>
<span class="c1">#   list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1"># * Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c1">#   this list of conditions and the following disclaimer in the documentation</span>
<span class="c1">#   and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># * Neither the name of the copyright holder nor the names of its</span>
<span class="c1">#   contributors may be used to endorse or promote products derived from</span>
<span class="c1">#   this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c1"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="c1"># DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<span class="c1"># FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="c1"># DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="c1"># SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="c1"># CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="c1"># OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c1"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;Utility used for handling automatic back-off.</span>

<span class="sd">This can be used to cover cases such as hitting rate-limits and failed requests.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="n">__all__</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Backoff&quot;</span><span class="p">,</span> <span class="s2">&quot;ErrorManager&quot;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">from</span> <span class="nn">hikari.impl</span> <span class="kn">import</span> <span class="n">rate_limits</span>

<span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">types</span>


<span class="n">ErrorManagerT</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;ErrorManagerT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;ErrorManager&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Backoff</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Used to exponentially backoff asynchronously.</span>

<span class="sd">    This class acts as an asynchronous iterator and can be iterated over to</span>
<span class="sd">    provide implicit backoff where for every iteration other than the first</span>
<span class="sd">    this will either back off for the time passed to `Backoff.set_next_backoff`</span>
<span class="sd">    if applicable or a time calculated exponentially.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    max_retries : typing.Optional[builtins.int]</span>
<span class="sd">        The maximum amount of times this should iterate for between resets.</span>
<span class="sd">        If left as `builtins.None` then this iterator will be unlimited.</span>
<span class="sd">        This must be greater than or equal to 1.</span>
<span class="sd">    base : builtins.float</span>
<span class="sd">        The base to use. Defaults to `2.0`.</span>
<span class="sd">    maximum : builtins.float</span>
<span class="sd">        The max value the backoff can be in a single iteration. Anything above</span>
<span class="sd">        this will be capped to this base value plus random jitter.</span>
<span class="sd">    jitter_multiplier : builtins.float</span>
<span class="sd">        The multiplier for the random jitter. Defaults to `1.0`.</span>
<span class="sd">        Set to `0` to disable jitter.</span>
<span class="sd">    initial_increment : builtins.int</span>
<span class="sd">        The initial increment to start at. Defaults to `0`.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If an `builtins.int` that&#39;s too big to be represented as a</span>
<span class="sd">        `builtins.float` or a non-finite value is passed in place of a field</span>
<span class="sd">        that&#39;s annotated as `builtins.float` or if `max_retries` is less than 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    An example of using this class as an asynchronous iterator may look like</span>
<span class="sd">    the following</span>

<span class="sd">    ```py</span>
<span class="sd">    # While we can directly do `async for _ in Backoff()`, by assigning it to a</span>
<span class="sd">    # variable we allow ourself to provide a specific backoff time in some cases.</span>
<span class="sd">    backoff = Backoff()</span>
<span class="sd">    async for _ in backoff:</span>
<span class="sd">        try:</span>
<span class="sd">            message = await bot.rest.fetch_message(channel_id, message_id)</span>
<span class="sd">        except errors.RateLimitedError as exc:</span>
<span class="sd">            # If we have a specific backoff time then set it for the next iteration</span>
<span class="sd">            backoff.set_next_backoff(exc.retry_after)</span>
<span class="sd">        except errors.InternalServerError:</span>
<span class="sd">            # Else let the iterator calculate an exponential backoff before the next loop.</span>
<span class="sd">            pass</span>
<span class="sd">        else:</span>
<span class="sd">            # We need to break out of the iterator to make sure it doesn&#39;t backoff again.</span>
<span class="sd">            # Alternatively `Backoff.finish()` can be called to break out of the loop.</span>
<span class="sd">            break</span>
<span class="sd">    ```</span>

<span class="sd">    Alternatively you may want to explicitly call `Backoff.backoff`, a</span>
<span class="sd">    alternative of the previous example which uses `Backoff.backoff` may</span>
<span class="sd">    look like the following</span>

<span class="sd">    ```py</span>
<span class="sd">    backoff = Backoff()</span>
<span class="sd">    message: typing.Optional[messages.Message] = None</span>
<span class="sd">    while not message:</span>
<span class="sd">        try:</span>
<span class="sd">            message = await bot.rest.fetch_message(channel_id, message_id)</span>
<span class="sd">        except errors.RateLimitedError as exc:</span>
<span class="sd">            # If we have a specific backoff time then set it for the next iteration.</span>
<span class="sd">            await backoff.backoff(exc.retry_after)</span>
<span class="sd">        except errors.InternalServerError:</span>
<span class="sd">            # Else let the iterator calculate an exponential backoff before the next loop.</span>
<span class="sd">            await backoff.backoff()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_backoff&quot;</span><span class="p">,</span> <span class="s2">&quot;_finished&quot;</span><span class="p">,</span> <span class="s2">&quot;_max_retries&quot;</span><span class="p">,</span> <span class="s2">&quot;_next_backoff&quot;</span><span class="p">,</span> <span class="s2">&quot;_retries&quot;</span><span class="p">,</span> <span class="s2">&quot;_started&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="n">maximum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">64.0</span><span class="p">,</span>
        <span class="n">jitter_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">initial_increment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_retries</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_retries must be greater than 1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span> <span class="o">=</span> <span class="n">rate_limits</span><span class="o">.</span><span class="n">ExponentialBackOff</span><span class="p">(</span>
            <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span> <span class="n">jitter_multiplier</span><span class="o">=</span><span class="n">jitter_multiplier</span><span class="p">,</span> <span class="n">initial_increment</span><span class="o">=</span><span class="n">initial_increment</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backoff</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_depleted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">StopAsyncIteration</span>

        <span class="c1"># We don&#39;t want to backoff on the first iteration.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="n">backoff_</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_depleted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether &quot;max_retries&quot; has been reached.</span>

<span class="sd">        This can be used to workout whether the loop was explicitly broken out</span>
<span class="sd">        of using `Backoff.finish`/`break` or if it hit &quot;max_retries&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sleep for the provided backoff or for the next exponent.</span>

<span class="sd">        This provides an alternative to iterating over this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backoff_ : typing.Optional[float]</span>
<span class="sd">            The time this should backoff for. If left as `builtins.None` then</span>
<span class="sd">            this will back off for the last time provided with</span>
<span class="sd">            `Backoff.set_next_backoff` if available or the next exponential time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mark the iterator as finished to break out of the current loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reset the backoff to it&#39;s original state to reuse it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">set_next_backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Specify a backoff time for the next iteration or `Backoff.backoff` call.</span>

<span class="sd">        If this is called then the exponent won&#39;t be increased for this iteration.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling this multiple times in a single iteration will overwrite any</span>
<span class="sd">            previously set next backoff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: maximum?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="n">backoff_</span>


<span class="k">class</span> <span class="nc">ErrorManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A context manager provided to allow for more concise error handling with `Backoff`.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    *rules : typing.Tuple[typing.Iterable[typing.Type[BaseException]], typing.Callable[[typing.Any], typing.Optional[bool]]]</span>
<span class="sd">        Rules to initiate this error context manager with.</span>

<span class="sd">        These are each a 2-length tuple where the tuple[0] is an</span>
<span class="sd">        iterable of types of the exceptions this rule should apply to</span>
<span class="sd">        and tuple[1] is the rule&#39;s callback function.</span>

<span class="sd">        The callback function will be called with the raised exception when it</span>
<span class="sd">        matches one of the passed exceptions for the relevant rule and may</span>
<span class="sd">        raise, return `builtins.True` to indicate that the current error should</span>
<span class="sd">        be raised outside of the context manager or</span>
<span class="sd">        `builtins.False`/`builtins.None` to suppress the current error.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The following is an example of using `ErrorManager` alongside `Backoff`</span>
<span class="sd">    in-order to handle the exceptions which may be raised while trying to</span>
<span class="sd">    reply to a message.</span>

<span class="sd">    ```py</span>
<span class="sd">    retry = Backoff()</span>
<span class="sd">    # Rules can either be passed to `ErrorManager`&#39;s initiate as variable arguments</span>
<span class="sd">    # or one at a time to `ErrorManager.with_rule` through possibly chained-calls.</span>
<span class="sd">    error_handler = (</span>
<span class="sd">        # For the 1st rule we catch two errors which would indicate the bot</span>
<span class="sd">        # no-longer has access to the target channel and break out of the</span>
<span class="sd">        # retry loop using `Backoff.retry`.</span>
<span class="sd">        ErrorManager(((errors.NotFoundError, errors.ForbiddenError), lambda _: retry.finish()))</span>
<span class="sd">            # For the 2nd rule we catch rate limited errors and set their</span>
<span class="sd">            # `retry` value as the next backoff time before suppressing the</span>
<span class="sd">            # error to allow this to retry the request.</span>
<span class="sd">            .with_rule((errors.RateLimitedError,), lambda exc: retry.set_next_backoff(exc.retry_after))</span>
<span class="sd">            # For the 3rd rule we suppress the internal server error to allow</span>
<span class="sd">            # backoff to reach the next retry and exponentially backoff as we</span>
<span class="sd">            # don&#39;t have any specific retry time for this error.</span>
<span class="sd">            .with_rule((errors.InternalServerError,), lambda _: False)</span>
<span class="sd">    )</span>
<span class="sd">    async for _ in retry:</span>
<span class="sd">        # We entre this context manager each iteration to catch errors before</span>
<span class="sd">        # they cause us to break out of the `Backoff` loop.</span>
<span class="sd">        with error_handler:</span>
<span class="sd">            await message.respond(&quot;General Kenobi&quot;)</span>
<span class="sd">            # We need to break out of `retry` if this request succeeds.</span>
<span class="sd">            break</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_rules&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">rules</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">{(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">callback</span><span class="p">)</span> <span class="k">for</span> <span class="n">exceptions</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorManager</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exception_type</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">exception</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">exception_traceback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TracebackType</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">assert</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># This shouldn&#39;t ever be None when exception_type isn&#39;t None.</span>
        <span class="k">for</span> <span class="n">rule</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exception_type</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
                <span class="c1"># For this context manager&#39;s rules we switch up how returns are handled to let the rules prevent</span>
                <span class="c1"># exceptions from being raised outside of the context by default by having `None` and `False` both</span>
                <span class="c1"># indicate don&#39;t re-raise (suppress) and `True` indicate that it should re-raise.</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">clear_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clear the rules registered with this handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">with_rule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">ErrorManagerT</span><span class="p">,</span>
        <span class="n">exceptions</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorManagerT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add a rule to this exception context manager.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exceptions : typing.Iterable[typing.Type[builtins.BaseException]]</span>
<span class="sd">            An iterable of types of the exceptions this rule should apply to.</span>
<span class="sd">        result : typing.Callable[[typing.Any], typing.Optional[builtins.bool]]</span>
<span class="sd">            The function called with the raised exception when it matches one</span>
<span class="sd">            of the passed `exceptions`.</span>
<span class="sd">            This may raise, return `builtins.True` to indicate that the current</span>
<span class="sd">            error should be raised outside of the context manager or</span>
<span class="sd">            `builtins.False`/`builtins.None` to suppress the current error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ErrorManager</span>
<span class="sd">            This returns the handler a rule was being added to in-order to</span>
<span class="sd">            allow for chained calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

        </details>

            </section>
                <section id="Backoff">
                                <div class="attr class">
        <a class="headerlink" href="#Backoff">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Backoff</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Backoff</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Used to exponentially backoff asynchronously.</span>

<span class="sd">    This class acts as an asynchronous iterator and can be iterated over to</span>
<span class="sd">    provide implicit backoff where for every iteration other than the first</span>
<span class="sd">    this will either back off for the time passed to `Backoff.set_next_backoff`</span>
<span class="sd">    if applicable or a time calculated exponentially.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    max_retries : typing.Optional[builtins.int]</span>
<span class="sd">        The maximum amount of times this should iterate for between resets.</span>
<span class="sd">        If left as `builtins.None` then this iterator will be unlimited.</span>
<span class="sd">        This must be greater than or equal to 1.</span>
<span class="sd">    base : builtins.float</span>
<span class="sd">        The base to use. Defaults to `2.0`.</span>
<span class="sd">    maximum : builtins.float</span>
<span class="sd">        The max value the backoff can be in a single iteration. Anything above</span>
<span class="sd">        this will be capped to this base value plus random jitter.</span>
<span class="sd">    jitter_multiplier : builtins.float</span>
<span class="sd">        The multiplier for the random jitter. Defaults to `1.0`.</span>
<span class="sd">        Set to `0` to disable jitter.</span>
<span class="sd">    initial_increment : builtins.int</span>
<span class="sd">        The initial increment to start at. Defaults to `0`.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If an `builtins.int` that&#39;s too big to be represented as a</span>
<span class="sd">        `builtins.float` or a non-finite value is passed in place of a field</span>
<span class="sd">        that&#39;s annotated as `builtins.float` or if `max_retries` is less than 1.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    An example of using this class as an asynchronous iterator may look like</span>
<span class="sd">    the following</span>

<span class="sd">    ```py</span>
<span class="sd">    # While we can directly do `async for _ in Backoff()`, by assigning it to a</span>
<span class="sd">    # variable we allow ourself to provide a specific backoff time in some cases.</span>
<span class="sd">    backoff = Backoff()</span>
<span class="sd">    async for _ in backoff:</span>
<span class="sd">        try:</span>
<span class="sd">            message = await bot.rest.fetch_message(channel_id, message_id)</span>
<span class="sd">        except errors.RateLimitedError as exc:</span>
<span class="sd">            # If we have a specific backoff time then set it for the next iteration</span>
<span class="sd">            backoff.set_next_backoff(exc.retry_after)</span>
<span class="sd">        except errors.InternalServerError:</span>
<span class="sd">            # Else let the iterator calculate an exponential backoff before the next loop.</span>
<span class="sd">            pass</span>
<span class="sd">        else:</span>
<span class="sd">            # We need to break out of the iterator to make sure it doesn&#39;t backoff again.</span>
<span class="sd">            # Alternatively `Backoff.finish()` can be called to break out of the loop.</span>
<span class="sd">            break</span>
<span class="sd">    ```</span>

<span class="sd">    Alternatively you may want to explicitly call `Backoff.backoff`, a</span>
<span class="sd">    alternative of the previous example which uses `Backoff.backoff` may</span>
<span class="sd">    look like the following</span>

<span class="sd">    ```py</span>
<span class="sd">    backoff = Backoff()</span>
<span class="sd">    message: typing.Optional[messages.Message] = None</span>
<span class="sd">    while not message:</span>
<span class="sd">        try:</span>
<span class="sd">            message = await bot.rest.fetch_message(channel_id, message_id)</span>
<span class="sd">        except errors.RateLimitedError as exc:</span>
<span class="sd">            # If we have a specific backoff time then set it for the next iteration.</span>
<span class="sd">            await backoff.backoff(exc.retry_after)</span>
<span class="sd">        except errors.InternalServerError:</span>
<span class="sd">            # Else let the iterator calculate an exponential backoff before the next loop.</span>
<span class="sd">            await backoff.backoff()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_backoff&quot;</span><span class="p">,</span> <span class="s2">&quot;_finished&quot;</span><span class="p">,</span> <span class="s2">&quot;_max_retries&quot;</span><span class="p">,</span> <span class="s2">&quot;_next_backoff&quot;</span><span class="p">,</span> <span class="s2">&quot;_retries&quot;</span><span class="p">,</span> <span class="s2">&quot;_started&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="n">maximum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">64.0</span><span class="p">,</span>
        <span class="n">jitter_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">initial_increment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_retries</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_retries must be greater than 1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span> <span class="o">=</span> <span class="n">rate_limits</span><span class="o">.</span><span class="n">ExponentialBackOff</span><span class="p">(</span>
            <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span> <span class="n">jitter_multiplier</span><span class="o">=</span><span class="n">jitter_multiplier</span><span class="p">,</span> <span class="n">initial_increment</span><span class="o">=</span><span class="n">initial_increment</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backoff</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_depleted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">raise</span> <span class="ne">StopAsyncIteration</span>

        <span class="c1"># We don&#39;t want to backoff on the first iteration.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="n">backoff_</span><span class="p">:</span> <span class="nb">float</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_depleted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether &quot;max_retries&quot; has been reached.</span>

<span class="sd">        This can be used to workout whether the loop was explicitly broken out</span>
<span class="sd">        of using `Backoff.finish`/`break` or if it hit &quot;max_retries&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sleep for the provided backoff or for the next exponent.</span>

<span class="sd">        This provides an alternative to iterating over this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backoff_ : typing.Optional[float]</span>
<span class="sd">            The time this should backoff for. If left as `builtins.None` then</span>
<span class="sd">            this will back off for the last time provided with</span>
<span class="sd">            `Backoff.set_next_backoff` if available or the next exponential time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mark the iterator as finished to break out of the current loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reset the backoff to it&#39;s original state to reuse it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">set_next_backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Specify a backoff time for the next iteration or `Backoff.backoff` call.</span>

<span class="sd">        If this is called then the exponent won&#39;t be increased for this iteration.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling this multiple times in a single iteration will overwrite any</span>
<span class="sd">            previously set next backoff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: maximum?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="n">backoff_</span>
</pre></div>

        </details>

            <div class="docstring"><p>Used to exponentially backoff asynchronously.</p>

<p>This class acts as an asynchronous iterator and can be iterated over to
provide implicit backoff where for every iteration other than the first
this will either back off for the time passed to <code><a href="#Backoff.set_next_backoff">Backoff.set_next_backoff</a></code>
if applicable or a time calculated exponentially.</p>

<h6 id="other-parameters">Other Parameters</h6>

<ul>
<li><strong>max_retries</strong> (typing.Optional[builtins.int]):
The maximum amount of times this should iterate for between resets.
If left as <code>builtins.None</code> then this iterator will be unlimited.
This must be greater than or equal to 1.</li>
<li><strong>base</strong> (builtins.float):
The base to use. Defaults to <code>2.0</code>.</li>
<li><strong>maximum</strong> (builtins.float):
The max value the backoff can be in a single iteration. Anything above
this will be capped to this base value plus random jitter.</li>
<li><strong>jitter_multiplier</strong> (builtins.float):
The multiplier for the random jitter. Defaults to <code>1.0</code>.
Set to <code>0</code> to disable jitter.</li>
<li><strong>initial_increment</strong> (builtins.int):
The initial increment to start at. Defaults to <code>0</code>.</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If an <code>builtins.int</code> that's too big to be represented as a
<code>builtins.float</code> or a non-finite value is passed in place of a field
that's annotated as <code>builtins.float</code> or if <code>max_retries</code> is less than 1.</li>
</ul>

<h6 id="examples">Examples</h6>

<p>An example of using this class as an asynchronous iterator may look like
the following</p>

<div class="codehilite"><pre><span></span><code><span class="c1"># While we can directly do `async for _ in Backoff()`, by assigning it to a</span>
<span class="c1"># variable we allow ourself to provide a specific backoff time in some cases.</span>
<span class="n">backoff</span> <span class="o">=</span> <span class="n">Backoff</span><span class="p">()</span>
<span class="k">async</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">backoff</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">fetch_message</span><span class="p">(</span><span class="n">channel_id</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">RateLimitedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># If we have a specific backoff time then set it for the next iteration</span>
        <span class="n">backoff</span><span class="o">.</span><span class="n">set_next_backoff</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">retry_after</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">InternalServerError</span><span class="p">:</span>
        <span class="c1"># Else let the iterator calculate an exponential backoff before the next loop.</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># We need to break out of the iterator to make sure it doesn&#39;t backoff again.</span>
        <span class="c1"># Alternatively `Backoff.finish()` can be called to break out of the loop.</span>
        <span class="k">break</span>
</code></pre></div>

<p>Alternatively you may want to explicitly call <code><a href="#Backoff.backoff">Backoff.backoff</a></code>, a
alternative of the previous example which uses <code><a href="#Backoff.backoff">Backoff.backoff</a></code> may
look like the following</p>

<div class="codehilite"><pre><span></span><code><span class="n">backoff</span> <span class="o">=</span> <span class="n">Backoff</span><span class="p">()</span>
<span class="n">message</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">messages</span><span class="o">.</span><span class="n">Message</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">rest</span><span class="o">.</span><span class="n">fetch_message</span><span class="p">(</span><span class="n">channel_id</span><span class="p">,</span> <span class="n">message_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">RateLimitedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># If we have a specific backoff time then set it for the next iteration.</span>
        <span class="k">await</span> <span class="n">backoff</span><span class="o">.</span><span class="n">backoff</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">retry_after</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">InternalServerError</span><span class="p">:</span>
        <span class="c1"># Else let the iterator calculate an exponential backoff before the next loop.</span>
        <span class="k">await</span> <span class="n">backoff</span><span class="o">.</span><span class="n">backoff</span><span class="p">()</span>
</code></pre></div>
</div>


                            <div id="Backoff.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Backoff.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Backoff</span><span class="signature">(
    max_retries: Optional[int] = None,
    *,
    base: float = 2.0,
    maximum: float = 64.0,
    jitter_multiplier: float = 1.0,
    initial_increment: int = 0
)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="n">maximum</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">64.0</span><span class="p">,</span>
        <span class="n">jitter_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">initial_increment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_retries</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_retries must be greater than 1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span> <span class="o">=</span> <span class="n">rate_limits</span><span class="o">.</span><span class="n">ExponentialBackOff</span><span class="p">(</span>
            <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span> <span class="n">jitter_multiplier</span><span class="o">=</span><span class="n">jitter_multiplier</span><span class="p">,</span> <span class="n">initial_increment</span><span class="o">=</span><span class="n">initial_increment</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Backoff.is_depleted" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Backoff.is_depleted">#&nbsp;&nbsp</a>

        <span class="name">is_depleted</span><span class="annotation">: bool</span>
    </div>

            <div class="docstring"><p>Whether "max_retries" has been reached.</p>

<p>This can be used to workout whether the loop was explicitly broken out
of using <code><a href="#Backoff.finish">Backoff.finish</a></code>/<code>break</code> or if it hit "max_retries".</p>
</div>


                            </div>
                            <div id="Backoff.backoff" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Backoff.backoff">#&nbsp;&nbsp</a>

        
            <span class="def">async def</span>
            <span class="name">backoff</span><span class="signature">(self, backoff_: Optional[float], /) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sleep for the provided backoff or for the next exponent.</span>

<span class="sd">        This provides an alternative to iterating over this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backoff_ : typing.Optional[float]</span>
<span class="sd">            The time this should backoff for. If left as `builtins.None` then</span>
<span class="sd">            this will back off for the last time provided with</span>
<span class="sd">            `Backoff.set_next_backoff` if available or the next exponential time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">backoff_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backoff_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff_</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Sleep for the provided backoff or for the next exponent.</p>

<p>This provides an alternative to iterating over this class.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>backoff_</strong> (typing.Optional[float]):
The time this should backoff for. If left as <code>builtins.None</code> then
this will back off for the last time provided with
<code><a href="#Backoff.set_next_backoff">Backoff.set_next_backoff</a></code> if available or the next exponential time.</li>
</ul>
</div>


                            </div>
                            <div id="Backoff.finish" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Backoff.finish">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">finish</span><span class="signature">(self) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mark the iterator as finished to break out of the current loop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

        </details>

            <div class="docstring"><p>Mark the iterator as finished to break out of the current loop.</p>
</div>


                            </div>
                            <div id="Backoff.reset" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Backoff.reset">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">reset</span><span class="signature">(self) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reset the backoff to it&#39;s original state to reuse it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backoff</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_started</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reset the backoff to it's original state to reuse it.</p>
</div>


                            </div>
                            <div id="Backoff.set_next_backoff" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Backoff.set_next_backoff">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">set_next_backoff</span><span class="signature">(self, backoff_: float, /) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">set_next_backoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backoff_</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Specify a backoff time for the next iteration or `Backoff.backoff` call.</span>

<span class="sd">        If this is called then the exponent won&#39;t be increased for this iteration.</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling this multiple times in a single iteration will overwrite any</span>
<span class="sd">            previously set next backoff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: maximum?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_backoff</span> <span class="o">=</span> <span class="n">backoff_</span>
</pre></div>

        </details>

            <div class="docstring"><p>Specify a backoff time for the next iteration or <code><a href="#Backoff.backoff">Backoff.backoff</a></code> call.</p>

<p>If this is called then the exponent won't be increased for this iteration.</p>

<p><em>Note:</em>
Calling this multiple times in a single iteration will overwrite any
previously set next backoff.</p>
</div>


                            </div>
                </section>
                <section id="ErrorManager">
                                <div class="attr class">
        <a class="headerlink" href="#ErrorManager">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ErrorManager</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ErrorManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A context manager provided to allow for more concise error handling with `Backoff`.</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    *rules : typing.Tuple[typing.Iterable[typing.Type[BaseException]], typing.Callable[[typing.Any], typing.Optional[bool]]]</span>
<span class="sd">        Rules to initiate this error context manager with.</span>

<span class="sd">        These are each a 2-length tuple where the tuple[0] is an</span>
<span class="sd">        iterable of types of the exceptions this rule should apply to</span>
<span class="sd">        and tuple[1] is the rule&#39;s callback function.</span>

<span class="sd">        The callback function will be called with the raised exception when it</span>
<span class="sd">        matches one of the passed exceptions for the relevant rule and may</span>
<span class="sd">        raise, return `builtins.True` to indicate that the current error should</span>
<span class="sd">        be raised outside of the context manager or</span>
<span class="sd">        `builtins.False`/`builtins.None` to suppress the current error.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The following is an example of using `ErrorManager` alongside `Backoff`</span>
<span class="sd">    in-order to handle the exceptions which may be raised while trying to</span>
<span class="sd">    reply to a message.</span>

<span class="sd">    ```py</span>
<span class="sd">    retry = Backoff()</span>
<span class="sd">    # Rules can either be passed to `ErrorManager`&#39;s initiate as variable arguments</span>
<span class="sd">    # or one at a time to `ErrorManager.with_rule` through possibly chained-calls.</span>
<span class="sd">    error_handler = (</span>
<span class="sd">        # For the 1st rule we catch two errors which would indicate the bot</span>
<span class="sd">        # no-longer has access to the target channel and break out of the</span>
<span class="sd">        # retry loop using `Backoff.retry`.</span>
<span class="sd">        ErrorManager(((errors.NotFoundError, errors.ForbiddenError), lambda _: retry.finish()))</span>
<span class="sd">            # For the 2nd rule we catch rate limited errors and set their</span>
<span class="sd">            # `retry` value as the next backoff time before suppressing the</span>
<span class="sd">            # error to allow this to retry the request.</span>
<span class="sd">            .with_rule((errors.RateLimitedError,), lambda exc: retry.set_next_backoff(exc.retry_after))</span>
<span class="sd">            # For the 3rd rule we suppress the internal server error to allow</span>
<span class="sd">            # backoff to reach the next retry and exponentially backoff as we</span>
<span class="sd">            # don&#39;t have any specific retry time for this error.</span>
<span class="sd">            .with_rule((errors.InternalServerError,), lambda _: False)</span>
<span class="sd">    )</span>
<span class="sd">    async for _ in retry:</span>
<span class="sd">        # We entre this context manager each iteration to catch errors before</span>
<span class="sd">        # they cause us to break out of the `Backoff` loop.</span>
<span class="sd">        with error_handler:</span>
<span class="sd">            await message.respond(&quot;General Kenobi&quot;)</span>
<span class="sd">            # We need to break out of `retry` if this request succeeds.</span>
<span class="sd">            break</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_rules&quot;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">rules</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">{(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">callback</span><span class="p">)</span> <span class="k">for</span> <span class="n">exceptions</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorManager</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">exception_type</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">exception</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
        <span class="n">exception_traceback</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">TracebackType</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">exception_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">assert</span> <span class="n">exception</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># This shouldn&#39;t ever be None when exception_type isn&#39;t None.</span>
        <span class="k">for</span> <span class="n">rule</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exception_type</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
                <span class="c1"># For this context manager&#39;s rules we switch up how returns are handled to let the rules prevent</span>
                <span class="c1"># exceptions from being raised outside of the context by default by having `None` and `False` both</span>
                <span class="c1"># indicate don&#39;t re-raise (suppress) and `True` indicate that it should re-raise.</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">clear_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clear the rules registered with this handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">with_rule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">ErrorManagerT</span><span class="p">,</span>
        <span class="n">exceptions</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorManagerT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add a rule to this exception context manager.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exceptions : typing.Iterable[typing.Type[builtins.BaseException]]</span>
<span class="sd">            An iterable of types of the exceptions this rule should apply to.</span>
<span class="sd">        result : typing.Callable[[typing.Any], typing.Optional[builtins.bool]]</span>
<span class="sd">            The function called with the raised exception when it matches one</span>
<span class="sd">            of the passed `exceptions`.</span>
<span class="sd">            This may raise, return `builtins.True` to indicate that the current</span>
<span class="sd">            error should be raised outside of the context manager or</span>
<span class="sd">            `builtins.False`/`builtins.None` to suppress the current error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ErrorManager</span>
<span class="sd">            This returns the handler a rule was being added to in-order to</span>
<span class="sd">            allow for chained calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

        </details>

            <div class="docstring"><p>A context manager provided to allow for more concise error handling with <code><a href="#Backoff">Backoff</a></code>.</p>

<h6 id="other-parameters">Other Parameters</h6>

<ul>
<li><p><strong>*rules</strong> (typing.Tuple[typing.Iterable[typing.Type[BaseException]], typing.Callable[[typing.Any], typing.Optional[bool]]]):
Rules to initiate this error context manager with.</p>

<p>These are each a 2-length tuple where the tuple[0] is an
iterable of types of the exceptions this rule should apply to
and tuple[1] is the rule's callback function.</p>

<p>The callback function will be called with the raised exception when it
matches one of the passed exceptions for the relevant rule and may
raise, return <code>builtins.True</code> to indicate that the current error should
be raised outside of the context manager or
<code>builtins.False</code>/<code>builtins.None</code> to suppress the current error.</p></li>
</ul>

<h6 id="examples">Examples</h6>

<p>The following is an example of using <code><a href="#ErrorManager">ErrorManager</a></code> alongside <code><a href="#Backoff">Backoff</a></code>
in-order to handle the exceptions which may be raised while trying to
reply to a message.</p>

<div class="codehilite"><pre><span></span><code><span class="n">retry</span> <span class="o">=</span> <span class="n">Backoff</span><span class="p">()</span>
<span class="c1"># Rules can either be passed to `ErrorManager`&#39;s initiate as variable arguments</span>
<span class="c1"># or one at a time to `<a href="#ErrorManager.with_rule">ErrorManager.with_rule</a>` through possibly chained-calls.</span>
<span class="n">error_handler</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># For the 1st rule we catch two errors which would indicate the bot</span>
    <span class="c1"># no-longer has access to the target channel and break out of the</span>
    <span class="c1"># retry loop using `Backoff.retry`.</span>
    <span class="n">ErrorManager</span><span class="p">(((</span><span class="n">errors</span><span class="o">.</span><span class="n">NotFoundError</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">ForbiddenError</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">retry</span><span class="o">.</span><span class="n">finish</span><span class="p">()))</span>
        <span class="c1"># For the 2nd rule we catch rate limited errors and set their</span>
        <span class="c1"># `retry` value as the next backoff time before suppressing the</span>
        <span class="c1"># error to allow this to retry the request.</span>
        <span class="o">.</span><span class="n">with_rule</span><span class="p">((</span><span class="n">errors</span><span class="o">.</span><span class="n">RateLimitedError</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">exc</span><span class="p">:</span> <span class="n">retry</span><span class="o">.</span><span class="n">set_next_backoff</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">retry_after</span><span class="p">))</span>
        <span class="c1"># For the 3rd rule we suppress the internal server error to allow</span>
        <span class="c1"># backoff to reach the next retry and exponentially backoff as we</span>
        <span class="c1"># don&#39;t have any specific retry time for this error.</span>
        <span class="o">.</span><span class="n">with_rule</span><span class="p">((</span><span class="n">errors</span><span class="o">.</span><span class="n">InternalServerError</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">retry</span><span class="p">:</span>
    <span class="c1"># We entre this context manager each iteration to catch errors before</span>
    <span class="c1"># they cause us to break out of the `Backoff` loop.</span>
    <span class="k">with</span> <span class="n">error_handler</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s2">&quot;General Kenobi&quot;</span><span class="p">)</span>
        <span class="c1"># We need to break out of `retry` if this request succeeds.</span>
        <span class="k">break</span>
</code></pre></div>
</div>


                            <div id="ErrorManager.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ErrorManager.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">ErrorManager</span><span class="signature">(
    *rules: Tuple[Iterable[Type[BaseException]], Callable[[Any], Optional[bool]]]
)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">rules</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span>
            <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
        <span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">{(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">callback</span><span class="p">)</span> <span class="k">for</span> <span class="n">exceptions</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">}</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="ErrorManager.clear_rules" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ErrorManager.clear_rules">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">clear_rules</span><span class="signature">(self) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">clear_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Clear the rules registered with this handler.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Clear the rules registered with this handler.</p>
</div>


                            </div>
                            <div id="ErrorManager.with_rule" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ErrorManager.with_rule">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">with_rule</span><span class="signature">(
    self: ~ErrorManagerT,
    exceptions: Iterable[Type[BaseException]],
    result: Callable[[Any], Optional[bool]]
) -&gt; ~ErrorManagerT</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">with_rule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="n">ErrorManagerT</span><span class="p">,</span>
        <span class="n">exceptions</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErrorManagerT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Add a rule to this exception context manager.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exceptions : typing.Iterable[typing.Type[builtins.BaseException]]</span>
<span class="sd">            An iterable of types of the exceptions this rule should apply to.</span>
<span class="sd">        result : typing.Callable[[typing.Any], typing.Optional[builtins.bool]]</span>
<span class="sd">            The function called with the raised exception when it matches one</span>
<span class="sd">            of the passed `exceptions`.</span>
<span class="sd">            This may raise, return `builtins.True` to indicate that the current</span>
<span class="sd">            error should be raised outside of the context manager or</span>
<span class="sd">            `builtins.False`/`builtins.None` to suppress the current error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ErrorManager</span>
<span class="sd">            This returns the handler a rule was being added to in-order to</span>
<span class="sd">            allow for chained calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">exceptions</span><span class="p">),</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>

        </details>

            <div class="docstring"><p>Add a rule to this exception context manager.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>exceptions</strong> (typing.Iterable[typing.Type[builtins.BaseException]]):
An iterable of types of the exceptions this rule should apply to.</li>
<li><strong>result</strong> (typing.Callable[[typing.Any], typing.Optional[builtins.bool]]):
The function called with the raised exception when it matches one
of the passed <code>exceptions</code>.
This may raise, return <code>builtins.True</code> to indicate that the current
error should be raised outside of the context manager or
<code>builtins.False</code>/<code>builtins.None</code> to suppress the current error.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ErrorManager</strong>: This returns the handler a rule was being added to in-order to
allow for chained calls.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>